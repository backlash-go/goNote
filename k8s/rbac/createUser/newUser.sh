#!/bin/bash

#生成私钥
(
  umask 077
  openssl genrsa -out wing.key 2048
)

#生成签名请求
openssl req -new -key wing.key -out wing.csr -subj "/CN=wing"

#生成证书
openssl x509 -req -in wing.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out wing.crt -days 365

#查看证书
openssl x509 -in wing.crt -text -noout

#User "wing" set.

kubectl config set-credentials wing --client-certificate=./wing.crt --client-key=./wing.key --embed-certs=true

#Context "wing@kubernetes" created.
kubectl config set-context wing@kubernetes --cluster=kubernetes --user=wing


kubectl config set-context kubernetes-admin@kubernetes --cluster=kubernetes --user=kubernetes-admin

# 查看上下文
kubectl config view
kubectl config current-context

#切换上下文

kubectl config use-context wing@kubernetes
kubectl config use-context kubernetes-admin@kubernetes


#
kubectl create role myrole  --verb=get,watch --resource=pod,svc

kubectl create rolebinding myrole-binding --role=myrole --user=wing





#to another kubectl client
#mkdir $HOME/.kube/
#touch config

cat <<EOF > $HOME/.kube/config
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJeE1EVXhOekEzTVRNMU0xb1hEVE14TURVeE5UQTNNVE0xTTFvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTW1oCnp1ZEd5ekF2dUNQdzRKdmJZdTNnbExSZlBhd2JsMGtFY2xrL253aExPbzFiRTVkMG53UWd4K3VBbnlFK1BHUGkKWmpVTFBuQm9lU0MzSFcxcHk1c0tHM2N5MUhYTmNWM29pZVI0SzVPSTFvaEhFckkxTkdZT3VQREUrWTJXdEJIRgpxdGdjZ0FlMWtpTzJ1dGltMTFjVGQwUS9Td1JoUHg2QzYxZUlDWTFOVFdScjUyaFFBV09ESklHSzlSK3NBLzVQCjFLbEEybXJpNWFVcWhPU25jS1pkb2N6ODVCNEJWRjBVbkRZZ1NIUkRWOU5Ic2VYSjRGcUtCcXEyektuZDJRNjkKWm1KWGRMTENiV0llNVRPZkxuYmMweHd4UUZManZIR2JGZHdjZkRyMmo5ejJWZ1pkWFJBZDFFdTg2ZEtsSEJ6ZgpxOXFxeGdoVXZJUmZ3NG1Oa0hrQ0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZFeEIxbUN5Y1JwNFB0WTVjeUViaFYzUG5jdnVNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFCYUZ6Uk9raVBWaUxNNlVHU2t2RDh2eVVkb3JoWlhyemhXT1NtcVFZSUUxSHU5UndjMwpKWGZtQnVnVThvdzVyM1JZSkxkL0k1M2p5RC9HcFE3TEg1amFHNnRJUmU2MDBwOE5qcCt1ZU5QamRoVEtuWlduCjR4enUvSlNRTE10eEhvS3ZxSmtCbWxLMkxwUDY4TldjUzl6bmdqSHRJZS9JOXRNOUNxOVFWQjZTM25YNzVxa3cKYlV3VkVnbWE0SGNuQlpLM3BaY0tjWmVoRXUrMlRPcVVMRkV0dk9rQmxObUdGT1ZoUXNJOWpMamdDSXpXRWV0UwpMbHpvMzVNaHBFY1VBOFZXUzJXRUZZaGRiK2NIUGJwc2ZpMlhuMElValROWTl1aUxOVjNwSFNKWlBtUVhrSkFuCnJXNDEyZ1dFdUtwOG1GUzFpMXNIb3NqdVZnVzZuTU04bFh6eQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    server: https://172.18.222.42:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: wing
  name: wing@kubernetes
current-context: wing@kubernetes
kind: Config
preferences: {}
users:
- name: wing
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNvRENDQVlnQ0NRRFkvNmxRaDRPaW5UQU5CZ2txaGtpRzl3MEJBUXNGQURBVk1STXdFUVlEVlFRREV3cHIKZFdKbGNtNWxkR1Z6TUI0WERUSXhNRFV5TnpBek16TXlOVm9YRFRJeU1EVXlOekF6TXpNeU5Wb3dEekVOTUFzRwpBMVVFQXd3RWQybHVaekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPYUJJZElDClJTM3JRbEhWMGRpdHZhcVJUR3JCREhkLzV5eFNQODRKbk9zVit0cklYWnNoVkV1Z3pNZXg4UDVHQVVKY1grWGQKdHpDbTQ0a2NTVGd2SFltcEFoT0QyQ2dHWThJUzJsZnhlb2tobW10QTZub3ZQK2Z5eUpyQll6RmRSZjVuclRVbwpoREtaNXQ5MWJtejFuUU11ejE5ZXRZTGx5TzBxWGNUSkhEenVJcGI1U3djUUNJUTUrWTFBZEUrTFNxaUJzQWxaClB0SGVoMklzMmJucEV3RXlyUlI2MFhOWE93MmNoTEw1NysxTEtTSmthZjRNYzFTeHBrcnRXRDU3Q0cwSER5eWEKN1N4S0RKMW9YVHhEMmthUFdUU1hiS3phS1BYcnhoUFVCWFdCL1lsUGpzNXYvWEZlZmFSMVNPMDhMbXNJbzJUSQozMmxtN3JDWDNCdU9LUU1DQXdFQUFUQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFvbWwyOFFIWGE2b25OaUpmCkRqTDkwY0xvWjE5NVBJV3VobEpKS1VhMDlBMTdSb1ZTTk5uU3Y5MmFIaVpqUXpOS1NmYmd3bnpnT2p3NDhCSnIKbzRveTZ0cjR2eElWL0tuZlUrenFWZWNtaHBobktua1JVNzd6M1dnVzdQVDdOVS9uYWpqcmxTQU1IL1ZXczBpQworQjQ0TmZmZ3gzdlV2K1gvSmREOUlndmJ3T2NDelRhYkMvMTQzU0xrNXlvblFuMzVjSjg1RXFuRDV6cUdIQ2dRCmVjUTlOT1RiNTlocXVWY0pibXRIZURENlNBbmJDY1pnRjduRTVKTWRuL0x4c1lMczNEcGNHWndTc2o2M2hjRmMKL2VEUHpOaVBQaWJ0Wk5TYStDTElHNFd3ZzBoaWpZNTcwV2pmTytoRW52THRSOUJwbjFpOEZ4V2hucmgwcGxqZQpSMDE1THc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBNW9FaDBnSkZMZXRDVWRYUjJLMjlxcEZNYXNFTWQzL25MRkkvemdtYzZ4WDYyc2hkCm15RlVTNkRNeDdIdy9rWUJRbHhmNWQyM01LYmppUnhKT0M4ZGlha0NFNFBZS0FaandoTGFWL0Y2aVNHYWEwRHEKZWk4LzUvTEltc0ZqTVYxRi9tZXROU2lFTXBubTMzVnViUFdkQXk3UFgxNjFndVhJN1NwZHhNa2NQTzRpbHZsTApCeEFJaERuNWpVQjBUNHRLcUlHd0NWayswZDZIWWl6WnVla1RBVEt0RkhyUmMxYzdEWnlFc3ZudjdVc3BJbVJwCi9neHpWTEdtU3UxWVBuc0liUWNQTEpydExFb01uV2hkUEVQYVJvOVpOSmRzck5vbzlldkdFOVFGZFlIOWlVK08Kem0vOWNWNTlwSFZJN1R3dWF3aWpaTWpmYVdidXNKZmNHNDRwQXdJREFRQUJBb0lCQUdMSWVHdjkyUlBpdkp0QgpuUnJVNm5HTXIwa1l6blR2OVd4REcyRDdNYXAxMHZtcjRLRzQyTjFJWGpvK2dkOFd0VGR4U3cvQnd0NHd4MVpkCkx1dkxGVWVIaklJOGdJZzJwTTNwTW5WNTRWK2ZiUVFGMy9iWkJQUXNVZGd3aElnRlJ4Zk42cWJiWkR3alJKUUQKU1gyY2pOdHVWaVN5KytySyt4N1loekxzVlJPdTBpRU1UT1hLZkVWRmlrMDRRZGxKNndraTByWnJiZlV1TmhhSwpZNFJvN2VlN1VNS2sva3Y1Q0huMjd2d0ZLQzU0Y1FFK0FlZVFEVXdodzBNNXJuQVhvd21SZ1kyRE9RanArOGozCjc5Vm83WVVOaWE1aFhSVjlUN2FmcFhVdVpncTUvNlltYXVmQ1FiNlFuUUJ2YVRtb1MwaWgvTVQzMExpbytqdjYKb1VHRHhERUNnWUVBOUwzc0IxK3VFZlBRejFxaVduRmNuWG5ERGdxK1hIc0hVdnN6d0dUYTFmOUl6OVF4N2JxRApNRFh4OXcwU0VGR0tlYUdKWTh2R2tQRjAzb1BvZ1pxbzJYMTBTNzRkZ3JvdE5ZMy9JRi9iWWQwdjd4enBuaTBrCmdTdU1TVFhLUXFXMi85c1NsdzZJN0hURmN6L0thckUvRk0yQUczaE5Ka3V3OUhDbUoyY0lnOThDZ1lFQThSdU0KeUJ3MFVMc0Q4R2NQTk96SlZhSkVpQStBcjBFRW84d1d4c00ydVVGWGd2V3NOdmZrR1VESXdGWVRsaVZoby93cgpvQ1o2ajNWK2N3bGlmTkw3QzBrbU1mZWtyWG1taGRhT0cvR3MzQnd5V0FjUDU5bEFHV1lVTXNHSE5QQVBKZ0RmCmRUa2pUVWg4SWRobmVkVmd3TjFZRUVYOFpDM3dJL05mRjFoSjMxMENnWUFLSGRPazFtS21vVkp2VDhySVBFbGMKeFF5NEJ0K3BpUGhiaU1DeDRqbGRnU2pzVmxRZUJJaXB0SUVrK2loVi9samdBRHBpb3FpNWt4R0dwU00yUUVOYwpnaUFOaFhWSTB4Tk5WR3BJVjA0Rk5KUm5xT1ZMUVloeHduQVJFcVVpcmlEcllJM2JLcUdrVEl0ZzRURW55ZDNXCnFVdnpWcnl4cVkxTi9WNFE0T1JzTndLQmdRQ0d6UEZqL0NqZnJmK2d5KzM3bUJ0a3JrbUVqSzVVelpRcmcvS0UKQkNhM1lxbnJ4VEVZdG5Xb0RNbHdoMitCOWJwbWRabHFlN2p3TmkrUlg0RFo2eGVDa3M0eEI1VGhqRzhteXZNKworbHE3NFdQZ1JXcUdKTGVxdTZDMVUvQWxEOFpZYUFxSFBuL1hPSngyUzhobW5IN3d0WkFENFMwZ1VYSytsdFhtCmRtMHUzUUtCZ1FDd1hjRmd3TnRKNSt2RVk4K09tSjU0UlNhVndXMnhPcE50YjZmaHhiUFpLQjFPTWo0YnloT1YKTThTSEZ5VVdSUTJPNldydGRmOE4vU2R0NWxETThJSEVpNUFaTjNGN0tFeHc4cnNoZDNLcCtiK2VCblZYeWZTRApLclYxK1psUzFHZVNEcTMxMTllV2gxb3dVODNtUDZiVmp2aFNvTlhZTVVtOFk2aktqWnNWRmc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
EOF




